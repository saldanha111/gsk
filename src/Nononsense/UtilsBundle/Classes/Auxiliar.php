<?php/** * Docxpresso SERVER SDK * * @copyright  Copyright (c) 2017 No-nonsense Labs (http://www.nononsenselabs.com) * @license    MIT * @link       https://opensource.org/licenses/MIT * @version    1.0 * @since      1.0 */namespace Nononsense\UtilsBundle\Classes;/** * A collection of auxiliary methods to streamline certain ptentially required * processes */class Auxiliar{    /**     * Construct     *      * @access public     */    public function __construct()    {    }    /**     * Returns a JSON string in Docxpresso format out of a given csv file     *      * @param string $csv path to the csv file     * @param string $separator char used to separate fields in the csv file     * @return string     * @access public     */    public function CSV2JSON($csv, $separator = ';')    {        $masterArray = array();        $row = 0;         if (($fh = fopen($csv, "r")) !== false) {                while (($data = fgetcsv($fh, 0, ";")) !== FALSE) {                        $masterArray[] = $data;                }        } else {                echo 'CSV file could not be opened.';        }	        fclose($fh);                $obj = new \stdClass();        $obj->varValues = new \stdClass();                $header = array_shift($masterArray);        $dimension = count($masterArray);        $length = count($header);        for ($k = 0; $k < $length; $k++){            $col = array();            for ($j = 0; $j < $dimension; $j++){                if (isset($masterArray[$j][$k])) {                    $col[] = rawurlencode($masterArray[$j][$k]);                }            }            $obj->varValues->{$header[$k]} = $col;        }                return json_encode($obj);            }        /**     * Returns an associative array out of a given csv file where each row key     * is the nth entry (default is zero, i.e. the first column)     *      * @param string $csv path to the csv file     * @param string $separator char used to separate fields in the csv file     * @param integer $index the identifier column for each array entry     * @return array     * @access public     */    public function CSV2Array($csv, $separator = ';', $index = 0)    {        $masterArray = array();        $row = 0;         if (($fh = fopen($csv, "r")) !== false) {                while (($data = fgetcsv($fh, 0, $separator)) !== FALSE) {                        $masterArray[] = $data;                }        } else {                echo 'CSV file could not be opened.';        }	        fclose($fh);                $result = array();                $header = array_shift($masterArray);        $dimension = count($masterArray);        $length = count($header);        for ($j = 0; $j < $dimension; $j++){            $row = array();            for ($k = 0; $k < $length; $k++){                if (isset($masterArray[$j][$k])) {                    $row[$header[$k]] = $masterArray[$j][$k];                }            }            $result[$masterArray[$j][$index]] = $row;        }                return $result;            }      public function curlRequest ($url, $opt = NULL) {        $status = 'KO';        $externalData = '';        $curlData = array();        $curlData['options'] = $opt;        $dataServer = curl_init();        curl_setopt($dataServer, CURLOPT_URL, $url);        //Modify the following line to avoid man in the middle attacks        curl_setopt($dataServer, CURLOPT_SSL_VERIFYPEER, false);        //curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, TRUE);        //curl_setopt ($ch, CURLOPT_CAINFO, $this->CAcerts);        //curl_setopt ($ch, CURLOPT_SSL_VERIFYHOST, 2);        curl_setopt($dataServer, CURLOPT_HEADER, 1);        curl_setopt($dataServer, CURLOPT_POST, 1);        curl_setopt($dataServer, CURLOPT_VERBOSE, 1);        curl_setopt($dataServer, CURLOPT_FOLLOWLOCATION, 1);        curl_setopt($dataServer, CURLOPT_FRESH_CONNECT, 1);        curl_setopt($dataServer, CURLOPT_RETURNTRANSFER, 1);        curl_setopt($dataServer, CURLINFO_HEADER_OUT, 1);        curl_setopt($dataServer, CURLOPT_CONNECTTIMEOUT, 10);        if (!empty($opt)){            curl_setopt($dataServer, CURLOPT_POSTFIELDS, $curlData);        }        $serverResponse = curl_exec($dataServer);        $header_size = curl_getinfo($dataServer, CURLINFO_HEADER_SIZE);        $header = substr($serverResponse, 0, $header_size);        $externalData = trim(substr($serverResponse, $header_size));        curl_close($dataServer);        $regex = '/HTTP\/[0-9]{1}\.[0-9]{1} ([0-9]{3}) /i';        preg_match_all($regex, $header, $matches);        if (in_array('200', $matches[1])) {            $status = 'OK';        }        $result = array();        $result['status'] = $status;        $result['externalData'] = $externalData;        $result['debug'] = $serverResponse;        return $result;    }}