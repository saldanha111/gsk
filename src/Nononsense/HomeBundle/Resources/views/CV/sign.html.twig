{% extends '::base.html.twig' %}
{% block page_title %}Docoaro - GSK | Documentos {% endblock %}
{% block head %}
    {{ parent() }}
    <link rel="stylesheet" href="/css/plugins/datapicker/datepicker3.css">
    <link rel="stylesheet" href="/plugins/select2/dist/css/select2.min.css">
    <link rel="stylesheet" href="/plugins/dual_listbox/dist/multi.min.css">
{% endblock %}
{% block main_title %} Firmar {{signature.action.nameAlternative}} - <b>{{item.template.name}} #{{item.id}}</b>{% endblock %}

{% block content %}

    <div class="wrapper wrapper-content animated fadeInUp">
        {% for flashMessage in app.session.flashbag.get('error') %}
        <div class="alert alert-danger alert-dismissable" style="margin: 10px 16px 0 16px">
            <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
            {{ flashMessage }}
        </div>
        {% endfor %}
        <form class="form-horizontal" id="form_item" action="{{path('nononsense_cv_record_sign', {'template': item.id}) }}" method="POST"  enctype="multipart/form-data">

            {% if signature.justification or signature.action.justification %}
                <div class="row">
                    <div class="col-lg-5 col-lg-offset-1">
                        {% if signature.justification %}
                            <p>Ha modificado valores previamente imputados. Explique por qué</p>
                        {% elseif  signature.action.justification %} 
                            <p>Esta acción requiere de una justificación obligatoria</p>
                        {% endif %} 
                        <textarea id="comment" name="justification" required="required" class="form-control" rows="10" cols="91"></textarea>
                    </div>
                </div>
                <br>
            {% endif %} 
            <div class="row">
                <div class="col-lg-5 col-lg-offset-1">
                    <div id="signature-pad">
                        <p>Introduzca su firma</p>
                        <input type="password" name="password" id="box_password" class="form-control" required="required"><br>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-5 col-lg-offset-1">
                    <a  class="btn btn-primary pull-right" name="btnsend" id="btnsend"><i class="fa fa-pencil" aria-hidden="true"></i> Firmar</a>
                </div>
            </div>
        </form>
    </div>

{% endblock %}

{% block scripts %}
    {{ parent() }}
    
<script  charset="utf-8">
    var dataworkflow;
    $( document ).ready(function() {
        
        
        ActivateMenu('en_vigor_gestion_plantillas');
        $('#side-menu').metisMenu();


       

        $('#btnsend').on('click', function () {
            if($("#box_password").length){
                $(this).hide(function() {
                    valid_password=password_valid($("#box_password").val());
                    console.log(valid_password);
                    if (!valid_password) {
                        $(this).show();
                        toastr.error("La contraseña es incorecta", 'aviso');
                    } else {
                        $("#form_item").submit();
                    }
                });

            }
        });

        $('#form_item input').on('keypress', function(e) {
            return e.which !== 13;
        });
    });

    function password_valid(password){
        var result;
        $.ajax({
            url: "{{ path('nononsense_mclean_get_sign_valid') }}",
            type: 'POST',
            dataType: 'json',
            async: false,
            data: {password: password},
            success: function(response) {
                console.log(response);
                if(response.valid){
                    result=true;
                }else{
                    result=false;
                }
            },
            error: function() {
                result=false;
            }
        });

        return result;
    }
</script>
{% endblock %}


