{% extends '::base.html.twig' %}
{% block page_title %}Docoaro - GSK | Listado de registros {% endblock %}
{% block head %}
{{ parent() }}
<link rel="stylesheet" href="/css/plugins/datapicker/datepicker3.css">
{% endblock %}
{% block main_title %} Buscador de contenido en plantillas{% endblock %}
{% block content %}

<div class="wrapper wrapper-content">
    {% for flashMessage in app.session.flashbag.get('error') %}
    <div class="alert alert-danger alert-dismissable" style="margin: 10px 16px 0 16px">
        <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
        {{ flashMessage }}
    </div><br>
    {% endfor %}
    {% for flashMessage in app.session.flashbag.get('success') %}
    <div class="alert alert-success alert-dismissable" style="margin: 10px 16px 0 16px">
        <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
        {{ flashMessage }}
    </div><br>
    {% endfor %}
    <div class="row">
        <div class="col-sm-12">
            <div>
                <div class="row">
                    <form class="form-horizontal" id="form_item" action="{{ path('nononsense_cv_content_search')}}" method="GET">
                        <div class="form-group">
                            <label class="col-sm-1 control-label">Contenido</label>
                            <div class="col-sm-9 item_filter">
                                <input type="text" name="content" class="form-control" value="{{filters.content is defined ? filters.content : ''}}">
                            </div>

                        </div>
                        <div class="form-group">
                            <label class="col-sm-1 control-label">ID Registro</label>
                            <div class="col-sm-1 item_filter">
                                <input type="number" name="id" class="form-control" value="{{filters.id is defined ? filters.id : ''}}">
                            </div>

                            <label class="col-sm-1 control-label">Nombre</label>
                            <div class="col-sm-2 item_filter">
                                <input type="text" name="name" class="form-control" value="{{filters.name is defined ? filters.name : ''}}">
                            </div>

                            <label class="col-sm-1 control-label">Usuario</label>
                            <div class="col-sm-2 item_filter">
                                <input type="text" name="creator" class="form-control" value="{{filters.creator is defined ? filters.creator : ''}}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-1 control-label">Variable</label>
                            <div class="col-sm-2 item_filter">
                                <input type="text" name="field" class="form-control" value="{{filters.field is defined ? filters.field : ''}}">
                            </div>
                            
                            <label class="col-sm-1 control-label">Valor</label>
                            <div class="col-sm-2 item_filter">
                                <input type="text" name="value" class="form-control" value="{{filters.value is defined ? filters.value : ''}}">
                            </div>
                        </div>
                        <div class="form-group">

                            <label class="col-sm-1 control-label">Fecha</label>
                            <div class="col-sm-1 item_filter">
                                <input type="text" class="form-control pull-right" autocomplete="off" name="from" id="from" value="{{filters.from is defined ? filters.from|date("Y-m-d") : ''}}">
                            </div>

                            <div class="col-sm-1">
                                <input type="text" class="form-control pull-right" autocomplete="off" name="until" id="until" value="{{filters.until is defined ? filters.until|date("Y-m-d") : ''}}">
                            </div>

                            <div class="col-sm-offset-1 col-sm-1">
                                <button type="submit" class="btn btn-primary pull-right">Filtrar</button>
                            </div>
                        </div>


                        <input type="hidden" name="record_contains" value="{{filters.record_contains is defined ? filters.record_contains : ''}}">
                      </form>
                </div>
                <div class="row">
                
                    <table id="inProcessParcial" class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID Registro</th>
                                <th>Nombre plantilla</th>
                                <th>Nº.evidencia</th>
                                <th>Campo</th>
                                <th>Nº.Linea</th>
                                <th>Valor</th>
                                <th>Valor anterior</th>
                                <th>Usuario</th>
                                <th>Fecha de modificación</th>
                                <th>Opciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for history in histories %}
                            <tr>
                                <td><a class="btn btn-xs btn-primary" href="{{ path('nononsense_cv_search')}}?id={{history.recordId}}"><i class="fa fa-file-text-o" aria-hidden="true"></i> {{history.recordId}}</a></td>
                                <td>{{history.templateName}}</td>
                                <td>{{history.numberSignature}}</td>
                                <td>{{history.field}}</td>
                                <td>{{history.index is defined and history.index != '' ? history.index : ''}}</td>
                                <td>
                                    {% if 'base64' in history.value %}
                                        <a href="{{path('nononsense_cv_content_search_file_download', {id: history.id})}}">Descargar archivo</a>
                                    {% else %}
                                        {{history.value}}
                                    {% endif %}
                                </td>
                                
                                <td>
                                    {% if 'base64' in history.prevValue %}
                                        <a href="{{path('nononsense_cv_content_search_file_download', {id: history.id})}}?type=prev">Descargar archivo</a>
                                    {% else %}
                                        {{history.prevValue}}
                                    {% endif %}
                                </td>
                                <td>{{history.userName}}</td>
                                <td>{{history.modified|date('Y-m-d H:i:s')}}</td>
                                <td>
                                    {% if history.lineOptions is defined and history.lineOptions is not null %}
                                        {% if history.lineOptions == 1 %}
                                            <span  class="btn btn-xs btn-primary disabled"><i class="fa fa-plus" aria-hidden="true"></i> Nuevo</span>
                                        {% elseif history.lineOptions == 0 %}
                                            <span  class="btn btn-xs btn-danger disabled"><i class="fa fa-times" aria-hidden="true"></i> Eliminado</span>
                                        {% endif %}
                                    {% else %}
                                         <span  class="btn btn-xs btn-warning disabled"><i class="fa fa-pencil" aria-hidden="true"></i> Modificado</span>
                                    {% endif %}
                                    
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    {% if pagination is defined and pagination.needed %}
                        {% include '::pagination2.html.twig' %}
                    {% endif %}
               
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block scripts %}
{{ parent() }}
<script src="/js/plugins/datapicker/bootstrap-datepicker.js"></script>
<script src="/js/plugins/datapicker/locales/bootstrap-datepicker.es.js" charset="UTF-8"></script>
<script>
  $(function () {
    $('#from').datepicker({
      autoclose: true,
      orientation: 'bottom auto',
      format: 'yyyy-mm-dd',
      language: 'es'
    });
    $('#until').datepicker({
      autoclose: true,
      orientation: 'bottom auto',
      format: 'yyyy-mm-dd',
      language: 'es'
    });
  });
</script>
{% endblock %}
