{% extends '::base.html.twig' %}
{% block page_title %}Docoaro - GSK |  Códigos de barras / {{code.id is not null ? 'Editar' : 'Crear'}} código de barras {% endblock %}
{% block head %}
    {{ parent() }}
{% endblock %}
{% block main_title %} Códigos / {{code.id is not null ? 'Editar' : 'Crear'}} codigo{% endblock %}

{% block content %}

    <div class="wrapper wrapper-content animated fadeInUp">
        {% for flashMessage in app.session.flashbag.get('error') %}
        <div class="alert alert-danger alert-dismissable" style="margin: 10px 16px 0 16px">
            <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
            {{ flashMessage }}
        </div>
        <br>
        {% endfor %}
        <form class="form-horizontal" id="form_item" action="{{ path('nononsense_mclean_code_edit',{'id': code.id is not null ? code.id : 0}) }}" method="POST">
            <div class="row">
                <div class="col-lg-4 col-lg-offset-1">
                    <div class="row">
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Departamento</label>
                            <div class="col-sm-7">
                                <select class="form-control select-department" name="department">
                                    <option value="0"></option>
                                    {% for department in departments %}
                                        <option value="{{department.id}}">{{department.name}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Centro de trabajo</label>
                            <div class="col-sm-7" id="cont-center">
                                <select class="form-control select-center" name="center">
                                    <option value="">Selecciona un departamento</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Material</label>
                            <div class="col-sm-7" id="cont-material">
                                <select class="form-control select-material" name="material">
                                    <option value="">Selecciona un centro de trabajo</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-11">
                    <button type="submit" class="btn btn-primary  pull-right"><i class="fa fa-floppy-o" aria-hidden="true"></i> {{code.id is not null ? 'Editar' : 'Registrar'}} código</button>
                </div>
            </div>
        </form>
        <input type="hidden" id="url_get_centers_json" value="{{ centersUrl }}"/>
        <input type="hidden" id="url_get_materials_json" value="{{ materialsUrl }}"/>
    </div>
    
{% endblock %}

{% block scripts %}
    {{ parent() }}
    <script>
    $( document ).ready(function() {
        ActivateMenu('admin_codes');
        $('#side-menu').metisMenu();
    });

    $(function(){
        $(document).on('change','.select-center',function(e){
            getMaterial();
        });
        $(document).on('change','.select-department',function(e){
            getCenter();
        });

        function getCenter(){
            const url_get_centers_json = $('#url_get_centers_json').val();
            const selectedDepartment = $('.select-department').val();
            show_loader();
            $.ajax({
                url: url_get_centers_json.replace('xxx', selectedDepartment),
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    hide_loader();
                    const res = JSON.parse(response);
                    if(res.status === 200){
                        $('#cont-center').html(res.data);
                        getMaterial();
                    }
                },
                error: function() {
                    hide_loader();
                    console.log("No se ha podido obtener la información");
                }
            });
        }

        function getMaterial(){
            const url_get_products_json = $('#url_get_materials_json').val();
            const selectedCenter = $('.select-center').val();
            show_loader();
            $.ajax({
                url: url_get_products_json.replace('xxx', selectedCenter),
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    hide_loader();
                    const res = JSON.parse(response);
                    if(res.status === 200){
                        $('#cont-material').html(res.data);
                    }
                },
                error: function() {
                    hide_loader();
                    console.log("No se ha podido obtener la información");
                }
            });
        }
    });
    </script>
{% endblock %}


