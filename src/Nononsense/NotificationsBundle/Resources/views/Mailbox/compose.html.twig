<div class="mail-box-header">
    <div class="pull-right tooltip-demo">
        <a href="#" class="btn btn-danger btn-sm" data-toggle="tooltip" data-placement="top" title="{{'Discard email'|trans}}" onclick="loadEvent ('inbox', 1, 'q', 0)"><i class="fa fa-times"></i> {{'Discard'|trans}}</a>
    </div>
    <h2>
        {{'Compose message'|trans}}
    </h2>
</div>
{{ form_start(composeMessage) }}
{{ form_errors(composeMessage) }}

<div class="mail-box">
    <div class="mail-body">
        <div class="form-horizontal">
            <div class="form-group">
                <label class="col-sm-2 control-label">{{'To:'|trans}}</label>
                <div class="col-sm-10">
                    {{ form_widget(
                                    composeMessage.groups, 
                                    {
                                    'attr': {
                                        'class': 'chosen-select form-group',
                                        'data-placeholder': 'Choose at least a group'|trans
                                            }
                                    }
                                ) 
                                }}
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">{{'Subject:'|trans}}</label>
                <div class="col-sm-10">
                    {{ form_widget(
                                    composeMessage.subject, 
                                    {
                                    'attr': {
                                        'class': 'form-control',
                                        'placeholder': 'Introduce the subject'|trans
                                            }
                                    }
                                ) 
                                }}
                </div>
            </div>
        </div>
    </div>
    <!-- This control is hidden -->
        <div  class="hiddenField">              
            {{ form_widget(composeMessage.body, {'value': composeMessage.body.vars.value|escape_tags}) }}
        </div>
    <div class="mail-text h-200">
        <div class="summernote">
            {{'<p>Introduce the <strong>message content</strong> here.</p>'|trans|raw}}
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="mail-body text-right tooltip-demo">
        {{ form_widget(composeMessage.save, {'attr' : {'class': 'btn btn-sm btn-primary'}}) }}
        <a href="mailbox.html" class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="top" title="{{'Discard email'|trans}}" onclick="loadEvent ('inbox', 1, 'q', 0)"><i class="fa fa-times"></i> {{'Discard'|trans}}</a>
    </div>
    <div class="clearfix"></div>
</div>
{{ form_end(composeMessage) }}

<!-- Chosen -->
    <script src="/js/plugins/chosen/chosen.jquery.js"></script>
<script>
    updateUnread({{unread}});   
    
    $('.summernote').html($('#compose_body').val());
    $('.summernote').summernote({
        lang: '{{app.request.locale}}',
        height: 240,
        onblur: function(e) {   
        }
    });

    var config = {
      '.chosen-select'           : {},
      '.chosen-select-deselect'  : {allow_single_deselect:true},
      '.chosen-select-no-single' : {disable_search_threshold:10},
      '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
      '.chosen-select-width'     : {width: 400}
    }
    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }

    $( "form" ).submit(function( event ) {
        $('#compose_body').val($(".summernote").code());
        return;
      });

    DesactivateMenu('browse_messages');
    ActivateMenu('compose_message');
    $('#side-menu').metisMenu();
</script>
   
